import { CodeBlock } from "@/components/docs/code-block"
import { Alert, AlertDescription, AlertTitle } from "@/components/docs/alert"

# Analytics Table

Set up the database table for tracking page views and events from multiple frontend websites.

## Overview

The analytics table stores visitor tracking data including:

- Event types (pageview, click, custom)
- Domain and path information
- Device and browser details
- Geographic location (country, city)
- Session tracking
- Custom metadata

## Database Schema

Run this SQL script in your Supabase SQL Editor:

<CodeBlock language="sql" filename="database-schema-analytics.sql">
{`-- Create analytics table
CREATE TABLE IF NOT EXISTS analytics (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  event_type TEXT NOT NULL CHECK (event_type IN ('pageview', 'click', 'custom')),
  domain TEXT NOT NULL,
  path TEXT NOT NULL,
  referrer TEXT,
  user_agent TEXT,
  ip_address TEXT,
  country TEXT,
  city TEXT,
  device_type TEXT,
  browser TEXT,
  os TEXT,
  screen_width INTEGER,
  screen_height INTEGER,
  session_id TEXT,
  metadata JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()) NOT NULL
);

-- Enable Row Level Security
ALTER TABLE analytics ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Users can view their own analytics"
  ON analytics FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own analytics"
  ON analytics FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- Create indexes
CREATE INDEX IF NOT EXISTS analytics_user_id_idx ON analytics(user_id);
CREATE INDEX IF NOT EXISTS analytics_domain_idx ON analytics(domain);
CREATE INDEX IF NOT EXISTS analytics_event_type_idx ON analytics(event_type);
CREATE INDEX IF NOT EXISTS analytics_created_at_idx ON analytics(created_at);
CREATE INDEX IF NOT EXISTS analytics_path_idx ON analytics(path);
CREATE INDEX IF NOT EXISTS analytics_session_id_idx ON analytics(session_id);`}
</CodeBlock>

## Analytics Summary Function

The schema includes a helper function for generating analytics summaries. This function is automatically created when you run the full schema file.

<Alert variant="info">
  <AlertTitle>Optional Feature</AlertTitle>
  <AlertDescription>
    The analytics table is optional. Only set it up if you want to track visitor data from your frontend websites.
  </AlertDescription>
</Alert>

