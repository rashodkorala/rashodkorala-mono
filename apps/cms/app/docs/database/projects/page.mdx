import { CodeBlock } from "@/components/docs/code-block"
import { Alert, AlertDescription, AlertTitle } from "@/components/docs/alert"

# Projects Table

Set up the database table for managing your personal projects.

## Overview

The projects table stores information about your personal projects including:

- Project name, description, and category
- Status tracking (Planning, In Progress, Completed, On Hold)
- Progress percentage and priority level
- Multiple images per project with cover photo support
- Links (website, project, GitHub)
- Technology tags
- Featured project flag

## Database Schema

Run this SQL script in your Supabase SQL Editor:

<CodeBlock language="sql" filename="database-schema.sql">
{`-- Create projects table
CREATE TABLE IF NOT EXISTS projects (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  description TEXT,
  category TEXT NOT NULL,
  status TEXT NOT NULL CHECK (status IN ('Planning', 'In Progress', 'Completed', 'On Hold')),
  progress INTEGER NOT NULL DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
  priority TEXT NOT NULL CHECK (priority IN ('High', 'Medium', 'Low')),
  due_date DATE,
  image_url TEXT[] DEFAULT '{}',
  cover_image_url TEXT,
  website_url TEXT,
  project_url TEXT,
  github_url TEXT,
  technologies TEXT[] DEFAULT '{}',
  featured BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()) NOT NULL
);

-- Enable Row Level Security
ALTER TABLE projects ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Users can view their own projects"
  ON projects FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own projects"
  ON projects FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own projects"
  ON projects FOR UPDATE
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can delete their own projects"
  ON projects FOR DELETE
  USING (auth.uid() = user_id);

-- Create indexes
CREATE INDEX IF NOT EXISTS projects_user_id_idx ON projects(user_id);
CREATE INDEX IF NOT EXISTS projects_featured_idx ON projects(featured) WHERE featured = TRUE;
CREATE INDEX IF NOT EXISTS projects_status_idx ON projects(status);

-- Create trigger for updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = TIMEZONE('utc', NOW());
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_projects_updated_at
  BEFORE UPDATE ON projects
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();`}
</CodeBlock>

## Adding Cover Image Column

If you need to add the cover image column to an existing table, run:

<CodeBlock language="sql" filename="database-migration-add-cover-image.sql">
{`-- Add cover_image_url column to projects table
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_schema = 'public' 
    AND table_name = 'projects' 
    AND column_name = 'cover_image_url'
  ) THEN
    ALTER TABLE projects ADD COLUMN cover_image_url TEXT;
    RAISE NOTICE 'Added cover_image_url column to projects table';
  END IF;
END $$;`}
</CodeBlock>

<Alert variant="info">
  <AlertTitle>Row Level Security</AlertTitle>
  <AlertDescription>
    All policies ensure users can only access their own projects. The `user_id` is automatically set from the authenticated user session.
  </AlertDescription>
</Alert>

